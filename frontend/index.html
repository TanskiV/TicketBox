<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
</head>
<body>
  <form id="loginForm">
    <input type="text" id="username" placeholder="login" required />
    <input type="password" id="password" placeholder="password" required />
    <button type="submit">Login</button>
  </form>
  <div id="error" style="color:red"></div>
<script>
async function check(){
  const res = await fetch('/api/me');
  if(res.ok){
    const u = await res.json();
    window.location.href = u.role === 'admin' ? '/admin.html' : '/app.html';
  }
}
check();
loginForm.addEventListener('submit', async e => {
  e.preventDefault();
  const body = {username: username.value, password: password.value};
  const res = await fetch('/api/login', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
  if(res.ok){
    const u = await res.json();
    window.location.href = u.role === 'admin' ? '/admin.html' : '/app.html';
  } else {
    error.textContent = 'Invalid credentials';
  }
});
</script>
</body>
</html>
