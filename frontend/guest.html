<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="title">Report Issue</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="header.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
  <body>
  <div id="header"></div>
  <div class="container">
    <h2 class="text-center mt-3" data-i18n="heading">Report an Issue</h2>
    <form id="guestForm" class="ticket-form form-section">
      <input type="text" id="room" class="form-control mb-2" data-i18n-placeholder="room" required />
      <textarea id="desc" class="form-control mb-2" data-i18n-placeholder="description"></textarea>
      <input type="file" id="photo" class="form-control mb-2" accept="image/*" />
      <button type="submit" class="btn btn-primary w-100" data-i18n="submit">Submit</button>
    </form>
  </div>
  <script>
    const translations = {
      en: {
        title: 'Report Issue',
        heading: 'Report an Issue',
        room: 'Room',
        description: 'Description',
        submit: 'Submit',
        roomRequired: 'Room is required',
        success: 'Thank you! Your ticket has been received.',
        serverError: 'Server error'
      },
      he: {
        title: '\u05D3\u05D5\u05D7 \u05EA\u05E7\u05DC\u05D4',
        heading: '\u05D3\u05D5\u05D7 \u05E2\u05DC \u05EA\u05E7\u05DC\u05D4',
        room: '\u05D7\u05D3\u05E8',
        description: '\u05EA\u05D9\u05D0\u05D5\u05E8',
        submit: '\u05E9\u05DC\u05D7',
        roomRequired: '\u05D7\u05D5\u05D1\u05D4 \u05DC\u05E6\u05D9\u05D9\u05DF \u05D7\u05D3\u05E8',
        success: '\u05EA\u05D5\u05D3\u05D4! \u05D4\u05E4\u05E0\u05D9\u05D9\u05D4 \u05E0\u05E7\u05DC\u05D4.',
        serverError: '\u05E9\u05D2\u05D9\u05D0\u05EA \u05E9\u05E8\u05EA'
      },
      ru: {
        title: '\u0421\u043E\u043E\u0431\u0449\u0438\u0442\u044C \u043E \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0435',
        heading: '\u0421\u043E\u043E\u0431\u0449\u0438\u0442\u044C \u043E \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0435',
        room: '\u041A\u043E\u043C\u043D\u0430\u0442\u0430',
        description: '\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435',
        submit: '\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C',
        roomRequired: '\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044F \u043D\u043E\u043C\u0435\u0440 \u043A\u043E\u043C\u043D\u0430\u0442\u044B',
        success: '\u0421\u043F\u0430\u0441\u0438\u0431\u043E! \u0412\u0430\u0448\u0430 \u0437\u0430\u044F\u0432\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0430.',
        serverError: '\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430'
      }
    };

    let currentLang = 'en';
    function t(key){ return translations[currentLang][key] || key; }
    function applyTranslations(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{ el.textContent = t(el.dataset.i18n); });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{ el.placeholder = t(el.dataset.i18nPlaceholder); });
      document.documentElement.lang = currentLang;
      document.documentElement.dir = currentLang === 'he' ? 'rtl' : 'ltr';
    }
    function setLang(lang){ currentLang = lang; localStorage.setItem('lang', lang); applyTranslations(); }
    function getLang(){ const s = localStorage.getItem('lang'); if(s) return s; return navigator.language && navigator.language.startsWith('he') ? 'he' : 'en'; }

    setLang(getLang());

    document.getElementById('guestForm').addEventListener('submit', async e => {
      e.preventDefault();
      const room = document.getElementById('room').value.trim();
      if (!room) { alert(t('roomRequired')); return; }
      const description = document.getElementById('desc').value.trim();
      const fd = new FormData();
      fd.append('room', room);
      fd.append('description', description);
      const file = document.getElementById('photo').files[0];
      if (file) fd.append('photo', file);
      const res = await fetch('/api/public-ticket', { method: 'POST', body: fd });
      if (res.ok) {
        alert(t('success'));
        e.target.reset();
      } else {
        const err = await res.json().catch(() => ({ error: t('serverError') }));
        alert(err.error || t('serverError'));
      }
    });
  </script>
</body>
</html>
